# نظام التفاوض - بيكيا

## كيف يعمل النظام؟

### 1. البائع يضيف المنتج
- يرفع 4 صور
- يدخل المعلومات والسعر الأصلي
- النظام يقترح سعر
- البائع يختار "بيكيا" أو "إعادة تدوير"

### 2. المنتج يروح للـ Admin
**الحالة: `pending` (قيد المراجعة)**

Admin عنده 3 خيارات:

#### أ) موافقة مباشرة
- يضغط "موافقة" بالسعر المقترح
- المنتج يتعرض للبيع فوراً
- **الحالة: `approved`**

#### ب) تفاوض
- يضغط "تفاوض"
- يدخل سعر جديد
- يكتب ملاحظة للبائع (اختياري)
- يضغط "إرسال العرض للبائع"
- **الحالة: `awaiting_seller` (في انتظار البائع)**

#### ج) رفض
- يضغط "رفض"
- يكتب سبب الرفض
- **الحالة: `rejected`**

### 3. البائع يشوف العرض في Profile
**لو Admin عمل تفاوض:**

البائع يشوف:
- السعر المقترح منه (مشطوب)
- العرض الجديد من Admin (بالأخضر)
- ملاحظة Admin (لو موجودة)
- زرين: "قبول العرض" أو "رفض العرض"

#### لو البائع وافق:
- المنتج يتعرض للبيع بالسعر الجديد
- **الحالة: `approved`**

#### لو البائع رفض:
- المنتج يترفض نهائياً
- **الحالة: `rejected`**
- السبب: "البائع رفض عرض التفاوض"

## حالات المنتج (Status)

| الحالة | الوصف | من يراها |
|--------|-------|----------|
| `pending` | قيد المراجعة | Admin + البائع |
| `awaiting_seller` | في انتظار موافقة البائع | Admin + البائع |
| `approved` | تم الموافقة | الجميع (في Home) |
| `rejected` | مرفوض | Admin + البائع |

## مثال عملي

### السيناريو:
1. **أحمد** يبيع كرسي
2. السعر الأصلي: 800 جنيه
3. النظام يقترح: 400 جنيه
4. أحمد يختار "بيكيا"

### في Admin Dashboard:
5. **Admin** يشوف الكرسي
6. يقرر إن 400 جنيه كتير
7. يضغط "تفاوض"
8. يدخل سعر جديد: 300 جنيه
9. يكتب ملاحظة: "الكرسي به بعض الخدوش، السعر المناسب 300 جنيه"
10. يضغط "إرسال العرض للبائع"

### في Profile أحمد:
11. أحمد يشوف إشعار "في انتظار موافقتك"
12. يشوف:
    - السعر المقترح: ~~400 جنيه~~
    - العرض الجديد: **300 جنيه**
    - ملاحظة: "الكرسي به بعض الخدوش..."

13. **لو وافق:**
    - الكرسي يتعرض للبيع بـ 300 جنيه
    - يظهر في Home للمشترين

14. **لو رفض:**
    - الكرسي يترفض نهائياً
    - مش هيتعرض للبيع

## ملاحظات مهمة

1. **Admin ممكن يوافق مباشرة** بدون تفاوض
2. **التفاوض مرة واحدة فقط** (مفيش جولات متعددة)
3. **البائع لازم يرد** على عرض التفاوض
4. **لو البائع رفض** مفيش رجعة، المنتج يترفض نهائياً
5. **الملاحظة اختيارية** لكن مفيدة للتوضيح

## قاعدة البيانات

### الحقول الجديدة:
- `negotiated_price`: السعر المتفاوض عليه من Admin
- `negotiation_note`: ملاحظة Admin للبائع
- `status`: يشمل حالات جديدة (`awaiting_seller`)

### Migration:
شغل `migration-add-negotiation.sql` في Supabase SQL Editor
